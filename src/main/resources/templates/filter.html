<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="robots" content="noindex, nofollow">

    <title>eRadios.in - Data Filter</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto&display=swap"
        rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="icon" href="/images/icon.png" type="image/x-icon">

    <style>
        /* Base styles for mobile (default) */
        body {
            font-family: 'Roboto', sans-serif;
            color: #333333;
            font-size: 16px;
            margin: 0;
            padding: 0;
        }

        .main-section {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            color: #1a1a2e;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #bd9208;
            text-align: center;
        }

        h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
            color: #1a1a2e;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }

        h4 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            color: #1a1a2e;
            margin-bottom: 0.5rem;
        }

        p,
        label,
        select,
        input {
            font-family: 'Roboto', sans-serif;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        ul {
            font-family: 'Roboto', sans-serif;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            padding-left: 1.2rem;
        }

        li {
            margin-bottom: 0.3rem;
        }

        a {
            color: #bd9208;
            text-decoration: none;
            transition: color 0.3s ease-in-out;
        }

        a:hover {
            color: #a07a06;
        }

        .navbar-brand i {
            color: #bd9208;
        }

        footer a {
            color: #fff;
        }

        footer a:hover {
            color: #bd9208;
        }

        .station-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            aspect-ratio: 1/1;
            margin-bottom: 0.5rem;
        }

        .play-btn i {
            font-size: 1.5rem;
            color: #bd9208;
            transition: color 0.3s ease-in-out;
        }

        .play-btn i:hover {
            color: #a07a06;
        }

        .btn-custom {
            background-color: #bd9208;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        .btn-custom:hover {
            background-color: #a07a06;
            transform: scale(1.05);
        }

        .btn-dark {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .form-control,
        .form-select {
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .container {
            padding: 0 1rem;
        }

        .ad-space {
            width: 100%;
            min-height: 60px;
            background: #f8f9fa;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
            max-width: 100%;
        }

        /* Adjustments for larger screens */
        @media (min-width: 576px) {
            h1 {
                font-size: 2rem;
                text-align: left;
            }

            h2 {
                font-size: 1.4rem;
            }

            h4 {
                font-size: 1.2rem;
            }

            p,
            label,
            select,
            input {
                font-size: 1rem;
            }

            ul {
                font-size: 1rem;
            }

            .station-image {
                width: 100px;
                height: 100px;
            }

            .play-btn i {
                font-size: 3rem;
            }

            .btn-custom,
            .btn-dark {
                padding: 0.6rem 1.2rem;
                font-size: 1rem;
            }

            .form-control,
            .form-select {
                font-size: 1rem;
            }

            .ad-space {
                max-width: 468px;
                min-height: 60px;
            }
        }

        @media (min-width: 768px) {
            .main-section {
                padding: 2rem;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
                border-radius: 15px;
            }

            h1 {
                font-size: 2.5rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .container {
                padding: 0 1.5rem;
            }

            .ad-space {
                max-width: 728px;
                min-height: 90px;
            }

            .play-btn i {
                font-size: 2rem;
            }
        }

        @media (min-width: 992px) {
            .container {
                max-width: 900px;
            }

            .main-section {
                padding: 2.5rem;
            }

            .play-btn i {
                font-size: 5rem;
            }
        }
    </style>
    <!-- HLS.js for streaming support -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12/dist/hls.min.js"></script>
</head>

<body>
    <!-- Loader Overlay -->
    <div id="pageLoader" style="
    position:fixed;
    top:0;left:0;width:100vw;height:100vh;
    background:linear-gradient(135deg, #fffbe6 0%, #fff3cd 100%);
    z-index:9999;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:opacity 0.4s;
  ">
        <div style="text-align:center;">
            <i class="fas fa-radiation fa-spin" style="font-size:8rem;color:#bd9208;"></i>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-radiation fa-spin fs-3 me-2"></i>eRadios.in</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/stations">Stations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contact">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/add-station"><i class="fas fa-plus-circle"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="py-3">
        <div class="container">
            <div class="main-section">
                <h1>Data Filter</h1>
                <div th:each="item,iterStat : ${data}">
                    <!-- Station Card -->
                    <div class="d-flex flex-column flex-md-row align-items-center mb-3">
                        <img th:src="${item.favicon}" th:alt="${item.name}"
                            class="station-image rounded mb-2 mb-md-0 me-md-2 border"
                            onerror="this.onerror=null; this.src='https://upload.wikimedia.org/wikipedia/commons/0/0b/Earphones_icon.png';">
                        <div class="d-flex align-items-center justify-content-between w-100">
                            <h2 class="text-center text-md-start mb-0" th:text="${item.name}">Station Name</h2>
                            <a class="play-btn" th:id="'play_btn_' + ${iterStat.index}"><i
                                    class="fas fa-play-circle"></i></a>
                        </div>
                    </div>
                    <hr>

                    <!-- Audio Player Script for this station -->
                    <script th:inline="javascript">
                        /*<![CDATA[*/
                        const player[[${ iterStat.index }]] = document.createElement('audio');
                        player[[${ iterStat.index }]].controls = false;
                        document.body.appendChild(player[[${ iterStat.index }]]);
                        const playBtn[[${ iterStat.index }]] = document.getElementById("play_btn_" + [[${ iterStat.index }]]);
                        const streamUrl[[${ iterStat.index }]] = /*[[${item.url_resolved}]]*/ '';
                        const stationHomepage[[${ iterStat.index }]] = /*[[${item.homepage}]]*/ '';
                        let isHls[[${ iterStat.index }]] = streamUrl[[${ iterStat.index }]].endsWith(".m3u8") || streamUrl[[${ iterStat.index }]].includes(".m3u8");

                        function setupStream[[${ iterStat.index }]]() {
                            if (isHls[[${ iterStat.index }]] && Hls.isSupported()) {
                                const hls = new Hls({ autoStartLoad: true });
                                hls.loadSource(streamUrl[[${ iterStat.index }]]);
                                hls.attachMedia(player[[${ iterStat.index }]]);
                                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                                    playBtn[[${ iterStat.index }]].innerHTML = `<i class="fas fa-play-circle"></i>`;
                                });
                            } else if (isHls[[${ iterStat.index }]] && player[[${ iterStat.index }]].canPlayType('application/vnd.apple.mpegurl')) {
                                player[[${ iterStat.index }]].src = streamUrl[[${ iterStat.index }]];
                                player[[${ iterStat.index }]].addEventListener('loadedmetadata', () => {
                                    playBtn[[${ iterStat.index }]].innerHTML = `<i class="fas fa-play-circle"></i>`;
                                });
                            } else {
                                player[[${ iterStat.index }]].src = streamUrl[[${ iterStat.index }]];
                                player[[${ iterStat.index }]].addEventListener('canplay', () => {
                                    playBtn[[${ iterStat.index }]].innerHTML = `<i class="fas fa-play-circle"></i>`;
                                });
                            }
                        }

                        setupStream[[${ iterStat.index }]]();

                        playBtn[[${ iterStat.index }]].addEventListener('click', () => {
                            if (player[[${ iterStat.index }]].paused) {
                                player[[${ iterStat.index }]].play().catch(err => {
                                    console.warn("Playback failed:", err);
                                    if (isHls[[${ iterStat.index }]] && Hls.isSupported()) {
                                        const hls = new Hls();
                                        hls.loadSource(streamUrl[[${ iterStat.index }]]);
                                        hls.attachMedia(player[[${ iterStat.index }]]);
                                        hls.on(Hls.Events.MANIFEST_PARSED, () => {
                                            player[[${ iterStat.index }]].play();
                                        });
                                    } else {
                                        alert('Cannot play stream. Opening in external player...');
                                        playBtn[[${ iterStat.index }]].innerHTML = `<a href="${stationHomepage[[${ iterStat.index }]]}" target="_blank"><i class="play-icon fas fa-external-link-alt"></i></a>`;
                                    }
                                });
                                playBtn[[${ iterStat.index }]].innerHTML = `<i class="fas fa-pause-circle"></i>`;
                            } else {
                                player[[${ iterStat.index }]].pause();
                                playBtn[[${ iterStat.index }]].innerHTML = `<i class="fas fa-play-circle"></i>`;
                            }
                        });

                        document.addEventListener('DOMContentLoaded', function () {
                            // keydown event listener for backquote key
                            document.addEventListener('keydown', function (event) {
                                if (event.key === '`') { // backquote key
                                    playBtn[[${ iterStat.index }]].click();
                                }
                            });
                        });
                        /*]]>*/
                    </script>

                    <!-- Pagination Buttons -->
                    <div class="d-flex justify-content-between my-3">
                        <a th:href="@{'/filter?page=' + ${currentPage-1}}"><button
                                class="btn btn-custom">Prev</button></a>
                        <a th:href="@{'/filter?page=' + ${currentPage+1}}"><button
                                class="btn btn-custom">Next</button></a>
                    </div>

                    <!-- Form -->
                    <form class="form-group station-form mb-4" th:id="'stationForm_' + ${iterStat.index}">

                        <label th:for="'isLive_' + ${iterStat.index}" class="form-label">Is Live:</label>
                        <select th:id="'isLive_' + ${iterStat.index}" class="form-select mb-3">
                            <option th:value="true" th:selected="${item.isLive} == true">True</option>
                            <option th:value="false" th:selected="${item.isLive} == false">False</option>
                        </select>
                        <input th:id="'id_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.id}" readonly />

                        <label class="form-label" th:for="'name_' + ${iterStat.index}">Name:</label>
                        <a target="_blank" th:href="@{'https://www.google.com/search?q=' + ${item.name}}"
                            class="text-end text-primary">&nbsp;&nbsp;&nbsp;&nbsp;Google It</a>
                        <input th:id="'name_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.name}" />
                        <iframe th:src="@{'https://www.google.com/search?igu=1&q=' + ${item.name}}" width="100%"
                            height="600"></iframe>

                        <label class="form-label" th:for="'about_' + ${iterStat.index}">About:</label>
                        <input th:id="'about_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.about}" />

                        <label class="form-label" th:for="'meta_Description_' + ${iterStat.index}">Meta
                            Description:</label>
                        <input th:id="'meta_Description_' + ${iterStat.index}" class="w-100 form-control mb-2"
                            type="text" th:value="${item.metaDescription}" />

                        <label class="form-label" th:for="'url_resolved_' + ${iterStat.index}">URL Resolved:</label>
                        <input th:id="'url_resolved_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.url_resolved}" />

                        <label class="form-label"
                            th:for="'homepage_' + ${iterStat.index}">Homepage:</label>&nbsp;&nbsp;&nbsp;&nbsp;
                        <a target="_blank" th:href="${item.homepage}" class="text-end text-primary">Visit</a>
                        <input th:id="'homepage_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.homepage}" />
                        <iframe th:src="@{${item.homepage}}" width="100%" height="400"></iframe>

                        <label class="form-label" th:for="'favicon_' + ${iterStat.index}">Favicon:</label>
                        <input th:id="'favicon_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.favicon}" />
                        
                        <label class="form-label" th:for="'tags_' + ${iterStat.index}">Tags:</label>
                        <input th:id="'tags_' + ${iterStat.index}" class="w-100 form-control mb-2" type="text"
                            th:value="${item.tags}" />
                        
                        <div class="d-flex justify-content-center mt-3">
                            <button class="btn btn-dark px-3 submitBtn" type="button"
                                th:data-index="${iterStat.index}">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-secondary py-4">
        <div class="container">
            <!-- First Row: Description and Links -->
            <div class="row align-items-start">
                <!-- Description Column -->
                <div class="col-md-8 col-12 mb-3 mb-md-0">
                    <small>
                        <p>
                            eRadios.in offers a wide variety of Indian radio stations for every taste and region. Stream
                            Hindi, Tamil, Bengali, Telugu, Malayalam, Marathi and more, featuring music, news, and
                            devotional content from India and around the globe. Access is completely free and
                            mobile-friendly, with new stations added regularly. Discover the sounds of India â€” live,
                            online, and anywhere.
                        </p>
                    </small>
                </div>
                <!-- Links Column -->
                <div class="col-md-4 col-12 text-md-end text-center">
                    <ul class="list-unstyled">
                        <li><a href="/privacy" class="text-secondary text-decoration-none">Privacy</a></li>
                        <li><a href="/about" class="text-secondary text-decoration-none">About</a></li>
                        <li><a href="/terms" class="text-secondary text-decoration-none">Terms</a></li>
                        <li><a href="/blogs" class="text-secondary text-decoration-none">Blogs</a></li>
                    </ul>
                </div>
            </div>
            <!-- Second Row: Copyright -->
            <div class="row mt-3">
                <div class="col-12 text-center">
                    <p class="mb-0 fs-6">&copy; 2025 eRadios.in</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Hide loader after DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                const loader = document.getElementById('pageLoader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.style.display = 'none', 400);
                }
            }, 400);
        });

        // Initialize dropdowns and badges for each form
        document.addEventListener('DOMContentLoaded', function () {                
            // Submit handler for each form
            document.querySelectorAll('.submitBtn').forEach(function (btn) {
                btn.addEventListener('click', async function (event) {
                    event.preventDefault();
                    const idx = btn.getAttribute('data-index');
                    const form = document.getElementById('stationForm_' + idx);

                    try {
                        const response = await fetch('/api/filter', {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                id: form.querySelector('[id^="id_"]').value,
                                name: form.querySelector('[id^="name_"]').value,
                                about: form.querySelector('[id^="about_"]').value,
                                metaDescription: form.querySelector('[id^="meta_Description_"]').value,
                                url_resolved: form.querySelector('[id^="url_resolved_"]').value,
                                homepage: form.querySelector('[id^="homepage_"]').value,
                                favicon: form.querySelector('[id^="favicon_"]').value,
                                tags: form.querySelector('[id^="tags_"]').value,
                                isLive: form.querySelector('[id^="isLive_"]').value
                            })
                        });
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        const data = await response.json();
                        alert('Data submitted successfully');
                        window.location.reload();
                    } catch (error) {
                        console.error('There seems to be an error: ', error);
                    }
                });
            });
        });
    </script>
</body>

</html>